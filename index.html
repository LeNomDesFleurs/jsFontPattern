
<html>



    <head>

        <style>
        .controller {
            position: absolute;
            background: rgb(144, 131, 131);
            opacity: 0.8;
            top: 2rem;
            right: 0.0rem;
            /* left: 0.1rem; */
            display: flex;
            flex-direction: column;
            padding: 1rem;
            border-radius: 1em;
            }

        .models-container {
            position: absolute;
            top: 0;
            width: auto;
            height: 30px;
            display: flex;
            background-color: rgb(0, 0, 0, 0);
        }
        </style>
    </head>
    <body>

<div class="controller">

    F O N T

    <input type="text" id="myText" value="G H O S T">
    <input type="text" id="font" value="serif">
    <input type="text" id="modifier" value="bold italics">
    <label for="lettersize">lettersize</label>
    <input type="range" id="lettersize" min="10" max="100" step="1" value="20">
    <span id="lettersize"></span>
    
    <label for="gap">gap</label>
    <input type="range" id="gap" min="0.5" max="10" step="0.01" value="1">
    <span id="gap"></span>
    
    M A R G I N

    <label for="margin">margin</label>
    <input type="range" id="margin" min="0" max="1" step="0.01" value="0.5">
    <span id="margin"></span>

    <label for="slider_wght">sin</label>
    <input type="range" id="slider_wght" min="0" max="100" step="0.1" value="2">
    <span id="value_wght"></span>
    <!-- <p></p> -->
    
    S P A C E

    <label for="vector">vector</label>
    <input type="range" id="vector" min="0.0" max="10" step="0.01" value="0">
    <span id="vector"></span>

    <label for="angle">angle</label>
    <input type="range" id="angle" min="-3.1" max="3.1" step="0.1" value="0">
    <span id="angle"></span>
</div>

        

    <!-- <canvas height="800" id="c" width="800"></canvas> -->
    <script>
// Source - https://stackoverflow.com/a
// Posted by toastrackengima, modified by community. See post 'Timeline' for change history
// Retrieved 2025-12-01, License - CC BY-SA 4.0

// TODO add a way to hide / show the sliders with a keyboard command


function createHiPPICanvas(width, height) {
    const ratio = window.devicePixelRatio;
    const canvas = document.createElement("canvas");

    canvas.width = width * ratio;
    canvas.height = height * ratio;
    canvas.style.width = width + "px";
    canvas.style.height = height + "px";
    canvas.getContext("2d").scale(ratio, ratio);

    return canvas;
}

function getRad(x1, y1, x2, y2){
    //cos(theta) = adj/hypo
    var adjacent = (x1-x2);
    var hypotenuse = dist(x1, y1, x2, y2);
    var theta = Math.acos(adjacent/hypotenuse)
  if (y1>y2){theta = -theta}
  return theta;
}

function getVector(rad){
    // hypotenuse = 1
    adj = Math.cos(rad);
    opp = Math.sin(rad);
    return [adj, opp];
}

function dist(ax, ay, bx, by){
    var a = ax - bx;
var b = ay - by;
var c = Math.hypot(a,b)
return c;
}

function generate(){
    // TODO make dynamic
var width = window.innerWidth;
var height = window.innerHeight;

var canvas = createHiPPICanvas(width, height);
if (document.body.hasChildNodes()) {
    document.body.removeChild(document.body.lastElementChild);
}
document.body.appendChild(canvas);

var ctx = canvas.getContext("2d")
// ctx.fillStyle = "black";
// ctx.textAlign = 'right';

var string = document.getElementById("myText").value;
var lenght = string.length;
var modifier = document.getElementById("modifier").value;
var lettersize = document.getElementById("lettersize").value;
var font = document.getElementById("font").value;
var fontdescr = `${lettersize}px ${modifier} ${font}`;
console.log(fontdescr)
// ctx.font = "50px bold italics Times";
ctx.font = fontdescr;
gap = document.getElementById("gap").value * lettersize;
for (var i = 1; i<(height/gap); i = i+1){
    index = i;
    let sint = document.getElementById("slider_wght").value;
    half = Math.floor((height/gap)/2.);
    if (index > half) {index = half - index % half;}
    margin_coef = document.getElementById("margin").value
    margin = ((Math.sin(index/half * sint)+1) * 100)*margin_coef;
    // (height/gap) - (i % ((height/gap)/2));

    for (var s = 0; s<((lenght*index)); s = s+1){
        w = margin+(((width-(margin*2)) / ((lenght*index)-1))*s);
        h = gap*i;
        var pointx = width/2;
        var pointy = height/2;
        var distance = dist(w, h, pointx, pointy);
        var vectoramount = document.getElementById("vector").value;
        distance = distance * vectoramount;
        var radoffset = 0.5 * document.getElementById("angle").value;
        var rad = getRad(w, h, pointx, pointy) + radoffset;
        var [vecx, vecy]= getVector(rad);
        var offsetvecx = vecx * distance;
        vecx = vecx * vectoramount * half * 2;
        var offsetvecy = vecy * distance;
        var vecy = vecy * vectoramount * half* 2;
        var distx = 20*Math.log((1-((pointx-w)/pointx)));
        var disty = 20*Math.log((1-((pointy-h)/pointy)));
        ctx.fillText(string[s%lenght], w-vecx-offsetvecx, h+vecy+offsetvecy);
    }
    // ctx.fillText(string[lenght-1], (width - 30), gap*i);

    //TODO general offset / wave / gravity

}
}

generate()
window.addEventListener("resize", generate);
document.getElementById("slider_wght").addEventListener("input", generate);
document.getElementById("margin").addEventListener("input", generate);
document.getElementById("lettersize").addEventListener("input", generate);
document.getElementById("gap").addEventListener("input", generate);
document.getElementById("vector").addEventListener("input", generate);
document.getElementById("angle").addEventListener("input", generate);
document.getElementById("myText").addEventListener("input", generate);
document.getElementById("font").addEventListener("input", generate);
document.getElementById("modifier").addEventListener("input", generate);

 

// ctx.font = "bold italic 50px Arial";
// // ctx.font = "50px Arial";
// ctx.fillText("Hello World",10,80);

// ctx.font = "50px Arial";
// ctx.strokeText("Hello World",10,80);
// console.log(canvas)

//TODO size problem on image conversion
// var img    = canvas.toDataURL("image/png");
//     document.write('<img src="'+img+'"/>');

</script> 

<!-- <script src="picture.js"></script> -->
</body>
</html>